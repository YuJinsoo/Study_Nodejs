# Nodejs에서 Thread Safe 란?

## 궁금함이 든 이유
- 웹소켓을 이용해 채팅 서비스를 개발
- 채팅 매니저 클래스를 개발했는데 멤버로 관리하는 두 어레이를 스레드 세이프하게 개발해야 하는지 궁금해짐.

### 결론은
> - 서버 자체에서 비동기 요청으로 같은 리소스에 접근(I/O로 파일을 읽거나 하는 등의 작업)하거나 서버를 `worker_threads`모듈을 사용해서 멀티 스레드로 동작하도록 구현한 것이 아니라면 고려 대상이 아님 <br>
> - `Nodejs` 싱글 이벤트 루프 구조이기 때문에 메인 스레드에서 순차적으로 처리합니다.
> - 그래서 기본적으로 동시에 같은 메모리를 참조하는 상황을 (스레드 세이프 문제를) 고려할 필요가 없습니다.

### 스레드 세이프 고려사항

1. 싱글 스레드 환경
    - 웹소켓 서버의 로직이 Node.js의 메인 스레드에서 실행되는 경우, 기본적으로는 스레드 세이프 문제를 걱정할 필요가 없습니다. 
    - 메인 스레드에서 순차적으로 처리되기 때문입니다.
2. 멀티 스레딩 사용 시
    - 만약 worker_threads 모듈을 사용하여 멀티 스레딩을 도입한 경우, 스레드 간 데이터 공유나 상태 변경을 위해 적절한 동기화 기법을 사용해야 합니다.
    - 예를 들어, 워커 스레드간에 메시지를 전송하거나, Atomics와 SharedArrayBuffer를 사용하여 데이터를 안전하게 공유할 수 있습니다.
3. 비동기 작업과 상태 관리
    - 웹소켓 서버에서 비동기 I/O 작업을 수행하면서 공유 자원(예: 메모리 내 데이터, 파일, 데이터베이스 연결 등)에 접근해야 하는 경우, 이러한 자원에 대한 접근을 적절히 관리해야 합니다. 
    - 예를 들어, 프로미스, async/await 패턴을 사용하여 비동기 작업의 완료를 기다리는 동안 공유 자원의 일관된 상태를 유지해야 합니다.


### 스레드 세이프 하게 개발하는 방법.

1. 비동기 작업의 동기화
async/await 구문을 사용하여 비동기 작업을 동기적으로 처리할 수 있습니다. 
이를 통해 코드의 실행 순서를 보다 명확하게 관리할 수 있으며, 동시에 실행되는 비동기 작업 간의 데이터 경쟁을 방지할 수 있습니다.

2. Promise와 함께하는 락 메커니즘: 
공유 자원에 대한 접근을 제어하기 위해 락(lock) 메커니즘을 구현할 수 있습니다. 
예를 들어, 공유 자원에 대한 접근 전에 Promise를 사용하여 락을 획득하고, 작업 완료 후 락을 해제하는 방식입니다. 
이 방법은 직접 구현해야 하며, Node.js 환경에서의 동시성 제어를 위한 일반적인 접근 방법 중 하나입니다.

3. EventEmitter 사용: 
Node.js의 EventEmitter 클래스를 사용하여 이벤트 기반의 동시성 제어를 구현할 수 있습니다. 
이 방법을 통해 특정 이벤트가 발생했을 때만 공유 자원에 대한 작업을 수행하도록 할 수 있으며, 
이벤트 루프의 비동기적 특성을 활용하여 동시성을 관리할 수 있습니다.

4. Worker Threads 사용: 
Node.js 10.5.0 이상에서는 worker_threads 모듈을 통해 멀티 스레딩을 지원합니다. 
이를 통해 CPU 집약적인 작업을 별도의 스레드에서 실행할 수 있으며, 
메인 스레드와는 독립적으로 실행되므로 공유 자원에 대한 동시성 제어를 용이하게 할 수 있습니다. 
그러나 웹소켓 연결과 같은 I/O 작업의 경우, 메인 스레드에서 처리하는 것이 일반적입니다.


EventEmitter, 락 메커니즘 구현, worker_threads 
적절해 보이는 것은 Promise인것 같습니다.


### Promise를 통한 lock 메커니즘 구현

왜 하나? 
-> 자원에 대해 쓰레드 세이프하게 동작하기 위해서
-> 채팅 메니저 인스턴스의 변수를 동시다발적으로 접속이 가능할 수 있기 때문에...
-> 하지만 ++ 작업이기 때문에 id는 걱정이 적지만, array가 문제라고 생각함.

필요 없어보입니다.





## nodejs...

string.trim() 하면 양쪽 공백 문자열을 제거해줍니다.
모두 공백 문자열일 경우 ''를 리턴

string.split()
string.substring()
string.repeat()
string.indexOf()
string.lastIndexOf()
string.charAt( index) > 인덱스 위치의 문자 1개 반환

공부해보기.

# vscode 리팩토링 툴? 단축키?

- ctrl + shift + R 
>> 원래 되는건데 Thunder Client 때문인지 안됨. Thunder Clinet로 지정되어버림

- F2: 심볼 이름 변경
변수명, 함수명, 클래스명을 한 번에 바꿔주는 단축키.

- F12: 심볼 정의로 이동
심볼 정의 코드로 빠르게 이동

- alt + shift + F12: 심볼 레퍼런스 찾기
심볼을 활용한 레퍼런스도 금세 찾을 수 있음


파일찾기 : ctrl + p
심볼찾기 : ctrl t   (ex 클래스 찾기)
터미널 : ctrl + `

네비게이션 탭 열기/닫기: ctrl + b



## 익스텐션
- Code Runner ( + ts-node)
타입스크립트 파일을 바로 컴파일하려 실행 결과를 얻을 수 있음.
자바스크립트 파일로의 컴파일이 필요 없음.
타입스크립트 코드를 테스트할 때 유용

- TypeScript Toolbox
타입스크립트 최적화 또는 자동 가져오기, getter, setter, 생성자 생성 등과 같은 많은 기능을 제공하는 올인원 확장이다.

- TypeScript Hero
설정된 규칙에 따라 import 구문을 정렬하고 사용되지 않는 것은 삭제
window : Ctrl Alt O
...?



### 디버거 설정?
https://wiki.yowu.dev/ko/Knowledge-base/TypeScript/debugging-typescript-and-nest-js-applications-with-visual-studio-code


# typescript guide book
https://yamoo9.gitbook.io/typescript/introduction


# play ground
https://www.typescriptlang.org/